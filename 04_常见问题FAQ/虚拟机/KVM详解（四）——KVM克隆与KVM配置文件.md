---
title: KVM详解（四）——KVM克隆与KVM配置文件
description: 
published: true
date: 2022-11-24T09:44:09.730Z
tags: 
editor: markdown
dateCreated: 2022-11-23T08:17:37.694Z
---

# KVM详解（四）——KVM克隆与KVM配置文件
## 一、KVM克隆
KVM支持虚拟机克隆，所谓虚拟机克隆，就是由一台指定的虚拟机生成另一台与其完全相同的虚拟机。
KVM虚拟机克隆命令格式为：

`virt-clone -o 【原虚拟机】 -n 【新虚拟机】 -f 【新虚拟机镜像名（含路径）`

例如，我们要把之前的centos7-1虚拟机进行克隆，如下（centos7-1.qcow2）所示：

那么就可以执行命令：

` virt-clone -o centos7-1 -n centos7-2 -f /var/lib/libvirt/images/centos7-2.img`

注意，-o参数后面跟的是原虚拟机的名称，而不要跟镜像格式，即需要把后面的后缀.qcow2去掉，-n跟的是新的虚拟机名称，-f跟的是新的虚拟机的路径加上文件名。
该命令执行过程如下：

执行结果如下：

![2022-11-24_80167.png](/2022-11-24_80167.png)

执行结果如下：

![2022-11-24_6640.png](/2022-11-24_6640.png)

可以看出，在该命令执行后，生成了centos7-2的克隆虚拟机镜像。
虚拟机管理器也可以看到这一台新的虚拟机，如下所示：

![2022-11-24_22134.png](/2022-11-24_22134.png)

之后，我们启动克隆后的虚拟机，发现启动和运行均正常，如下所示：

![2022-11-24_18423.png](/2022-11-24_18423.png)


## 二、KVM配置文件
尽管上面我们成功克隆了一台KVM的虚拟机并成功运行，但是有一定计算机基础的小伙伴一定会问，这台虚拟机会不会与之前被克隆的虚拟机冲突的问题。该问题是非常有可能发生的，并且也必须引起我们的重视。尽管我们在进行虚拟机克隆时，希望能够完全按照原始虚拟机的配置进行克隆。但是，有时候配置完全相同却并不是一件好事！例如，我们并不希望两台虚拟的MAC地址相同，因为这会造成局域网内MAC地址冲突。此外，还有一些牵扯到网卡的配置文件等，我们也不希望克隆后的虚拟机和克隆前的虚拟机完全相同。

想要看虚拟机的一些硬件信息，我们可以查看KVM虚拟机的配置文件，该文件通常位于/etc/libvert/qemu/目录下，如下所示：

![2022-11-24_90565.png](/2022-11-24_90565.png)

KVM会为每个虚拟机生成一个配置文件，配置文件内含有MAC地址等信息，如下所示：


![2022-11-24_4052.png](/2022-11-24_4052.png)


我们可以打开克隆前和克隆后的虚拟机配置文件，查看它们的MAC地址、UUID等信息。可以明显发现，KVM有着很人性化的一点就是会帮助克隆后的虚拟机自动生成新的UUID和MAC地址，因此，我们的虚拟机一经克隆，就立刻可以使用了。

注意：
1、关于克隆后的虚拟机IP地址，如果不是DHCP的话还需要更改一下。
2、如果KVM虚拟机是CentOS6，那么虚拟机的克隆会出现一些问题，我们在后面会涉及到这一部分。





