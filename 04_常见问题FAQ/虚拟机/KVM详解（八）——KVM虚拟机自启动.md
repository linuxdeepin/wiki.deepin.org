---
title: KVM详解（八）——KVM虚拟机自启动
description: 
published: true
date: 2022-11-24T13:17:23.346Z
tags: 
editor: markdown
dateCreated: 2022-11-24T13:14:47.735Z
---

# KVM详解（八）——KVM虚拟机自启动
## 一、KVM虚拟机自启动简介
在有些场景下，我们需要设置KVM的虚拟机随着宿主机的启动，而自行启动。KVM的虚拟机自启动设置很简单，只需要执行命令：

`virsh autostart 【虚拟机名称】`

但是，在实际配置中，我们往往遇上很多“坑”，这大多是由于一些细节没有注意而导致的，今天，我就对KVM虚拟机的自启动设置进行详细说明。

## 二、libvertd服务自启动
要实现KVM虚拟机在物理机开启后能够自动启动运行，那么我们必须要设置libvirt（KVM的虚拟化服务）服务自动开启。否则，我们的KVM虚拟机会由于libvirt服务没有启动而启动失败。
libvert服务设置自启动命令为：

`systemctl enable libvirtd`

## 三、磁盘自动挂载
接下来，由于我们在虚拟机安装时，为KVM虚拟机的镜像单独设置了一块磁盘，这样，如果我们在虚拟机启动时，光盘没有挂载，那么KVM虚拟机由于找不到镜像文件，也会启动失败。因此，我们必须设置在开机后，虚拟机镜像必须存在，如果您设置是虚拟机镜像就存放在启动磁盘中，那么可以跳过这一步。但是如果您的虚拟机镜像文件存放在另一块磁盘中，必须挂载才能使用的话，就必须设置虚拟机镜像磁盘自动挂载。
要设置磁盘自动挂载，需要打开/etc/fstab文件，在文件最下方增加配置如下：

`/dev/sdb1 /var/lib/libvirt/images xfs defaults 0 0`

对上述配置不知道含义的，可以参考以下文章：Linux磁盘管理实战，相信您一定会有所收获！

## 四、设置虚拟机自启动
之后，我们需要设置虚拟机自启动，假设我们要设置centos7-1.qcow2的虚拟机自启动，那么我们需要执行命令：

`virsh autostart centos7-1.qcow2`

这样，该虚拟机就会在系统启动后自启动了。


